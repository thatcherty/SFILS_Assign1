@page
@model IndexModel

<h2>Patrons</h2>

<form method="get" id="filterForm">
    <table class="table table-striped table-sm align-middle">
        <thead>
            <tr>
                <th>ID</th>
                <th>Patron Type</th>
                <th>Age Range</th>
                <th>Home Library</th>
                <th>Notif Pref</th>
                <th>Prov Email</th>
                <th>In County</th>
                <th>Year</th>
                <th>Checkouts</th>
                <th>Renewals</th>
                <th></th>
            </tr>
            
            <tr>
                <th>
                 
                    <input class="form-control form-control-sm" name="patronId" value="@(Model.patronId?.ToString())" placeholder="ID" />
                </th>
                <th>
                    <select class="form-select form-select-sm" name="patronType" asp-items="Model.PatronTypeOptions">
                        <option value="">(all)</option>
                    </select>
                </th>
                <th>
                    <select class="form-select form-select-sm" name="ageRange" asp-items="Model.AgeRangeOptions">
                        <option value="">(all)</option>
                    </select>
                </th>
                <th>
                    <select class="form-select form-select-sm" name="homeLib" asp-items="Model.HomeLibraryOptions">
                        <option value="">(all)</option>
                    </select>
                </th>
                <th>
                    <select class="form-select form-select-sm" name="notifPref" asp-items="Model.NotificationPrefOptions">
                        <option value="">(all)</option>
                    </select>
                </th>
                <th>
                    <select class="form-select form-select-sm" name="provEmail">
                        <option value="">(all)</option>
                        <option value="true" selected="@(Model.provEmail == true)">Yes</option>
                        <option value="false" selected="@(Model.provEmail == false)">No</option>
                    </select>
                </th>
                <th>
                    <select class="form-select form-select-sm" name="inCounty">
                        <option value="">(all)</option>
                        <option value="true" selected="@(Model.inCounty == true)">Yes</option>
                        <option value="false" selected="@(Model.inCounty == false)">No</option>
                    </select>
                </th>
                <th>
                    <div class="d-flex gap-1">
                        <input class="form-control form-control-sm" name="yearMin" type="number" value="@(Model.yearMin?.ToString())" placeholder="Min" />
                        <input class="form-control form-control-sm" name="yearMax" type="number" value="@(Model.yearMax?.ToString())" placeholder="Max" />
                    </div>
                </th>
                <!--Add in checkouts and renewals filtering-->
                <th>

                    <input class="form-control form-control-sm" name="checkouts" value="@(Model.checkouts?.ToString())" placeholder="Min" />
                </th>
                <th>

                    <input class="form-control form-control-sm" name="renewal" value="@(Model.renewals?.ToString())" placeholder="Min" />
                </th>
                <th colspan="6">
                    <div class="d-flex gap-2 justify-content-end">
                        <input type="hidden" name="pageNumber" value="1" />
                        <input type="hidden" name="pageSize" value="@Model.pageSize" />
                        <button class="btn btn-sm btn-primary" type="submit">Apply</button>
                        <a class="btn btn-sm btn-outline-secondary" href="@Url.Page("./Index")">Clear</a>
                    </div>
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in Model.Rows)
            {
                <tr>
                    <td>@r.PatronId</td>
                    <td>@r.PatronType</td>
                    <td>@r.AgeRange</td>
                    <td>@r.HomeLibrary</td>
                    <td>@r.NotifPref</td>
                    <td>@(r.ProvidedEmail ? "Yes" : "No")</td>
                    <td>@(r.WithinCounty ? "Yes" : "No")</td>
                    <td>@r.YearReg</td>
                    <td>@r.TotalCheckouts</td>
                    <td>@r.TotalRenewals</td>
                    <td><a asp-page="Edit" asp-route-id="@r.PatronId">Edit</a></td>
                    <td><a asp-page="Details" asp-route-id="@r.PatronId">Details</a></td>
                </tr>
            }
        </tbody>
    </table>
</form>


<nav class="mt-2" aria-label="Pagination">
    <ul class="pagination">
        <li class="page-item @(Model.pageNumber <= 1 ? "disabled" : "")">
            <a class="page-link"
               asp-page="./Index"
               asp-route-pageNumber="@(Model.pageNumber - 1)"
               asp-route-pageSize="@Model.pageSize"
               asp-route-patronType="@Model.patronType"
               asp-route-ageRange="@Model.ageRange"
               asp-route-homeLib="@Model.homeLib"
               asp-route-notifPref="@Model.notifPref"
               asp-route-provEmail="@(Model.provEmail?.ToString().ToLower())"
               asp-route-inCounty="@(Model.inCounty?.ToString().ToLower())"
               asp-route-yearMin="@Model.yearMin"
               asp-route-yearMax="@Model.yearMax"
               asp-route-yearMin="@Model.checkouts"
               asp-route-yearMax="@Model.renewals"
               asp-route-q="@Model.patronId">« Prev</a>
        </li>

        @for (var i = Math.Max(1, Model.pageNumber - 2); i <= Math.Min(Model.TotalPages, Model.pageNumber + 2); i++)
        {
            <li class="page-item @(i == Model.pageNumber ? "active" : "")">
                <a class="page-link"
                   asp-page="./Index"
                   asp-route-pageNumber="@i"
                   asp-route-pageSize="@Model.pageSize"
                   asp-route-patronType="@Model.patronType"
                   asp-route-ageRange="@Model.ageRange"
                   asp-route-homeLib="@Model.homeLib"
                   asp-route-notifPref="@Model.notifPref"
                   asp-route-provEmail="@(Model.provEmail?.ToString().ToLower())"
                   asp-route-inCounty="@(Model.inCounty?.ToString().ToLower())"
                   asp-route-yearMin="@Model.yearMin"
                   asp-route-yearMax="@Model.yearMax"
                   asp-route-yearMin="@Model.checkouts"
                   asp-route-yearMax="@Model.renewals"
                   asp-route-q="@Model.patronId">@i</a>
            </li>
        }

        <li class="page-item @(Model.pageNumber >= Model.TotalPages ? "disabled" : "")">
            <a class="page-link"
               asp-page="./Index"
               asp-route-pageNumber="@(Model.pageNumber + 1)"
               asp-route-pageSize="@Model.pageSize"
               asp-route-patronType="@Model.patronType"
               asp-route-ageRange="@Model.ageRange"
               asp-route-homeLib="@Model.homeLib"
               asp-route-notifPref="@Model.notifPref"
               asp-route-provEmail="@(Model.provEmail?.ToString().ToLower())"
               asp-route-inCounty="@(Model.inCounty?.ToString().ToLower())"
               asp-route-yearMin="@Model.yearMin"
               asp-route-yearMax="@Model.yearMax"
               asp-route-yearMin="@Model.checkouts"
               asp-route-yearMax="@Model.renewals"
               asp-route-q="@Model.patronId">Next »</a>
        </li>
    </ul>
</nav>